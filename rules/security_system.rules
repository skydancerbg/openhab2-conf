// 

// RF PIR 1 CODE: D3C22E    ОФИС
// RF PIR 2 CODE: D511CE    РАБОТИЛНИЦА
// RF PIR 3 CODE: D5053E    ХОЛ
// RF PIR 4 CODE: D48C4E    ГАРАЖ
// RF PIR 5 CODE: D3426E    КОРИДОР ЕТ. 1

rule "Security system Notification"
when
  Member of Gr_Sequrity_System_Motion received command ON
then
    if(Alarm_Arm_Disarm.state == ON) {
        logInfo("SECURITY_SYSTEM", "Motion detected in ARM mode: Sending notification!!!"))
        sendNotification("sshivarov@yahoo.com", "Alarm, АЛАРМА! от "+ triggeringItem.name)
    // TODO: Start the SECURITY SYSTEM SIREN  
    }
end

// GF_WS_NU_WF_DIY_Alarm_Status_Display_BlueLED1
// GF_WS_NU_WF_DIY_Alarm_Status_Display_BlueLED2
// GF_WS_NU_WF_DIY_Alarm_Status_Display_GreenLED
// GF_WS_NU_WF_DIY_Alarm_Status_Display_RedLED  
// GF_WS_NU_WF_DIY_Alarm_Status_Display_Buzzer  

rule "Arm/Disarm switch"
when
    Item Alarm_Arm_Disarm_Switch changed
then
    switch (Alarm_Arm_Disarm_Switch.state as DecimalType) {
        case 0 : { // DISARM
            Alarm_Arm_Disarm.sendCommand(OFF)
            GF_WS_NU_WF_DIY_Alarm_Status_Display_GreenLED.sendCommand(ON)
            GF_WS_NU_WF_DIY_Alarm_Status_Display_RedLED.sendCommand(OFF)
            GF_WS_NU_WF_DIY_Alarm_Status_Display_Buzzer.sendCommand(OFF)           
        }
        case 1 : { // ARM
            GF_WS_NU_WF_DIY_Alarm_Status_Display_GreenLED.sendCommand(OFF)
            GF_WS_NU_WF_DIY_Alarm_Status_Display_RedLED.sendCommand(ON)
            GF_WS_NU_WF_DIY_Alarm_Status_Display_Buzzer.sendCommand(ON)
                logInfo("SECURITY_SYSTEM", "before timer")
            createTimer(now.plusMinutes(0.5), [|
                logInfo("SECURITY_SYSTEM", "in the timer")
                GF_WS_NU_WF_DIY_Alarm_Status_Display_Buzzer.sendCommand(OFF)
                Alarm_Arm_Disarm.sendCommand(ON)
                // .postUpdate(0)
                // Alarm_Arm_Disarm
                ])
                logInfo("SECURITY_SYSTEM", "after timer")
        }
    }
end
